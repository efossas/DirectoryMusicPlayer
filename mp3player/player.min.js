!function(){function e(){var e=0;for(e=0;e<n.length;e++)n[e].audio.pause(),n[e].updateDisplay()}function t(e,t){var a=t-e.toString().length+1;return new Array(+(a>0&&a)).join("0")+e}function a(e){if(isNaN(e))return"--:--";var a=Math.floor(e/60);return e-=60*a,t(a,2)+":"+t(e,2)}function i(e){return e=decodeURI(e),e.split("/").pop().split(".").shift().replace(/-/g," | ").replace(/_/g," ")}var n=[],o=function(e){this.player=e,this.audio=e.getElementsByTagName("audio").item(0),this.debug=e.getElementsByClassName("debug").item(0),this.audio.setAttribute("preload","auto"),this.state=this.audio.autoplay?"playing":"paused",this.repeat=this.audio.loop?!0:!1,this.audio.removeAttribute("loop"),this.trackList=[],this.init()};o.prototype.log=function(e){this.debug&&(this.debug.appendChild(document.createTextNode(e)),this.debug.appendChild(document.createElement("br")),this.debug.scrollTop=this.debug.scrollHeight-this.debug.clientHeight)},o.prototype.canPlay=function(e){return/mp3/i.test(e)&&this.audio.canPlayType("audio/mpeg")?!0:/ogg/i.test(e)&&this.audio.canPlayType("audio/ogg")?!0:!1},o.prototype.loadSources=function(){var e=this,t=[];e.log("func: loadSources");e.audio.getElementsByTagName("source");[].forEach.call(e.audio.getElementsByTagName("source"),function(a){var i=a.getAttribute("src").split("/").pop(),n=i.split(".").pop(),o=i.split(".").shift(),d=e.canPlay(n);-1===e.trackList.indexOf(o)&&d===!0?e.trackList.push(o):t.push(a)}),[].forEach.call(t,function(e){e.parentNode.removeChild(e)})},o.prototype.updateDisplay=function(){var e=this.audio,t=a(Math.ceil(e.duration)),n=a(Math.ceil(e.currentTime)),o=i(e.currentSrc);this.player.getElementsByClassName("trackLength").item(0).innerHTML=t,this.player.getElementsByClassName("trackTime").item(0).innerHTML=n,this.player.getElementsByClassName("trackTitle").item(0).innerHTML=o;var d=this.player.getElementsByClassName("play").item(0);this.audio.paused?(d.classList.remove("playing"),d.classList.add("paused")):(d.classList.remove("paused"),d.classList.add("playing"))},o.prototype.loadTrack=function(e){var t=this.audio.getElementsByTagName("source").item(e).getAttribute("src");this.audio.src=t,"paused"===this.state&&this.audio.pause(),this.currentTrack=e,this.log("func: loadTrack: loaded "+t)},o.prototype.loadNext=function(){this.log("func: loadNext");var e=this.audio.getElementsByTagName("source").length,t=(1+this.currentTrack)%e;t<=this.currentTrack&&!this.repeat&&(this.state="paused"),this.loadTrack(t)},o.prototype.loadPrevious=function(){this.log("func: loadPrevious");var e=this.audio.getElementsByTagName("source").length,t=(this.currentTrack+(e-1))%e;this.loadTrack(t)},o.prototype.setAudioEventHandlers=function(){var e=this;e.log("func: setAudioEventHandlers"),e.audio.addEventListener("abort",function(){e.log("event: audio abort")}),e.audio.addEventListener("canplay",function(){e.log("event: audio canplay"),"playing"===e.state&&this.paused&&this.play(),e.updateDisplay()}),e.audio.addEventListener("canplaythrough",function(){e.log("event: audio canplaythrough")}),e.audio.addEventListener("durationchange",function(){e.log("event: audio durationchange")}),e.audio.addEventListener("emptied",function(){e.log("event: audio emptied")}),e.audio.addEventListener("ended",function(){e.log("event: audio ended"),e.loadNext()}),e.audio.addEventListener("error",function(){e.log("event: audio error")}),e.audio.addEventListener("loadeddata",function(){e.log("event: audio loadeddata")}),e.audio.addEventListener("loadedmetadata",function(){e.log("event: audio loadedmetadata")}),e.audio.addEventListener("loadstart",function(){e.log("event: audio loadstart")}),e.audio.addEventListener("pause",function(){e.log("event: audio pause")}),e.audio.addEventListener("play",function(){e.log("event: audio play")}),e.audio.addEventListener("playing",function(){e.log("event: audio playing")}),e.audio.addEventListener("progress",function(){e.log("event: audio progress")}),e.audio.addEventListener("ratechange",function(){e.log("event: audio ratechange")}),e.audio.addEventListener("seeked",function(){e.log("event: audio seeked")}),e.audio.addEventListener("seeking",function(){e.log("event: audio seeking")}),e.audio.addEventListener("stalled",function(){e.log("event: audio stalled")}),e.audio.addEventListener("suspend",function(){e.log("event: audio suspend")}),e.audio.addEventListener("timeupdate",function(){e.updateDisplay()}),e.audio.addEventListener("volumechange",function(){e.log("event: audio volumechange")}),e.audio.addEventListener("waiting",function(){e.log("event: audio waiting")})},o.prototype.setClickHandlers=function(){var t=this;t.log("func: setClickHandlers");var a=t.audio;[].forEach.call(t.player.getElementsByClassName("forward"),function(e){e.addEventListener("click",function(){t.log("event: click .forward"),t.loadNext()})}),[].forEach.call(t.player.getElementsByClassName("play"),function(a){a.addEventListener("click",function(){t.log("event: click .play"),t.audio.paused?(e(),t.audio.play(),t.state="playing"):(t.audio.pause(),t.state="paused"),t.updateDisplay()})}),[].forEach.call(t.player.getElementsByClassName("rewind"),function(e){e.addEventListener("click",function(){t.log("event: click .rewind");var e=a.currentTime;e>1.5?a.currentTime=0:t.loadPrevious()})}),t.debug&&t.debug.click(function(){$(this).empty()})},o.prototype.init=function(){var e=this;e.setAudioEventHandlers(),e.loadSources(),e.currentTrack=0,e.setClickHandlers(),e.updateDisplay()},document.addEventListener("DOMContentLoaded",function(){[].forEach.call(document.getElementsByClassName("player"),function(e){n.push(new o(e))})})}();
